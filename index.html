<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SD STORE ADMIN</title>

<link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@400;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
:root{
  --bg:#f8fafc; --card:#fff; --text:#1e293b;
  --accent:#6366f1; --green:#10b981; --red:#ef4444; --yellow:#f59e0b;
}
body{
  margin:0; font-family:'Hind Siliguri',sans-serif;
  background:var(--bg); color:var(--text);
  padding-top:210px;
}
header{
  position:fixed; inset:0 0 auto 0;
  background:linear-gradient(135deg,#4f46e5,#7c3aed);
  padding:15px; z-index:1000;
  box-shadow:0 5px 20px rgba(0,0,0,.15);
}
h1{color:#fff;margin:0;font-size:20px;}
button{cursor:pointer}

.tabs{display:flex;gap:8px;margin-top:15px}
.tab{
  flex:1;text-align:center;padding:10px;
  border-radius:12px;
  background:rgba(255,255,255,.15);
  color:#fff;font-weight:700;font-size:13px;
}
.tab.active{background:#fff;color:#4f46e5}

.search{
  margin-top:12px; position:relative;
}
.search input{
  width:100%;padding:14px 45px;
  border-radius:14px;border:none;outline:none;
}
.search i{position:absolute;left:16px;top:17px;color:#94a3b8}

#addBtn{
  margin-top:10px;width:100%;padding:14px;
  border:none;border-radius:14px;
  background:#22c55e;color:#fff;
  font-weight:800;display:none;
}

.card{
  background:var(--card); margin:12px 15px;
  border-radius:18px;padding:15px;
  box-shadow:0 5px 12px rgba(0,0,0,.06);
  border-left:6px solid var(--accent);
}
.card.hot{border-left-color:var(--yellow)}
.card.expired{border-left-color:var(--red)}

.badge{
  font-size:11px;padding:4px 8px;
  border-radius:10px;background:#e5e7eb;
}

#loader{
  position:fixed;inset:0;
  background:rgba(0,0,0,.7);
  display:none;align-items:center;justify-content:center;
  flex-direction:column;color:#fff;z-index:9999;
}
.spinner{
  width:40px;height:40px;border:4px solid #fff;
  border-top-color:var(--accent);
  border-radius:50%;animation:spin 1s linear infinite;
}
@keyframes spin{to{transform:rotate(360deg)}}

.modal{
  position:fixed;inset:0;
  background:rgba(0,0,0,.7);
  display:none;align-items:center;justify-content:center;
  z-index:2000;
}
.modal-box{
  background:#fff;width:90%;max-width:350px;
  border-radius:20px;padding:25px;
}
.modal-box a{
  display:block;text-align:center;
  padding:14px;border-radius:14px;
  background:#10b981;color:#fff;
  font-weight:800;text-decoration:none;
}
.delete{
  margin-top:15px;width:100%;
  border:none;background:none;
  color:#ef4444;font-weight:700;
}
</style>
</head>

<body>

<div id="loader">
  <div class="spinner"></div>
  <b style="margin-top:10px">লোড হচ্ছে...</b>
</div>

<header>
  <div style="display:flex;justify-content:space-between;align-items:center">
    <h1>SD STORE ADMIN</h1>
    <button onclick="syncAll()" style="background:#fff;border:none;border-radius:10px;padding:6px 15px;font-weight:800">SYNC</button>
  </div>

  <div class="tabs">
    <div class="tab active" onclick="switchTab('all',this)">All</div>
    <div class="tab" onclick="switchTab('home',this)">Homeline</div>
    <div class="tab" onclick="switchTab('hot',this)">Hotspot</div>
    <div class="tab" onclick="switchTab('exp',this)">Expired</div>
  </div>

  <div class="search">
    <i class="fa fa-search"></i>
    <input id="search" onkeyup="handleSearch()" placeholder="ID বা নাম লিখুন">
    <button id="addBtn" onclick="addUser()">+ Add New User</button>
  </div>
</header>

<div id="list"></div>

<div class="modal" id="modal" onclick="closeModal()">
  <div class="modal-box" onclick="event.stopPropagation()">
    <h3 id="mName"></h3>
    <div id="mInfo" style="font-size:14px;line-height:1.6"></div>
    <a id="pay" target="_blank">Pay Now</a>
    <button class="delete" onclick="deleteUser()">Delete User</button>
  </div>
</div>

<script>
const API_URL="https://YOUR-FLASK-URL";
let users=[],tab="all",activeId=null;

window.onload=load;

async function load(){
 show(); 
 const r=await fetch(API_URL+"/get_all_users");
 users=await r.json();
 hide(); render();
}

function daysLeft(d){
 if(!d) return 999;
 return Math.ceil((new Date(d)-new Date())/86400000);
}

function render(){
 const q=document.getElementById("search").value.toLowerCase();
 let data=users.filter(u=>
  (u.name||"").toLowerCase().includes(q) ||
  u.user_id.includes(q)
 );

 if(tab==="home") data=data.filter(u=>u.billing_id);
 if(tab==="hot") data=data.filter(u=>!u.billing_id);
 if(tab==="exp") data=data.filter(u=>daysLeft(u.expire)<=0);

 let html="";
 data.forEach(u=>{
  const d=daysLeft(u.expire);
  const cls=d<=0?"expired":(!u.billing_id?"hot":"");
  html+=`
  <div class="card ${cls}" onclick="openModal('${u.user_id}')">
    <b>${u.name||"অপেক্ষা করুন..."}</b>
    <span class="badge" style="float:right">${u.expire||""}</span>
    <div style="font-size:12px;opacity:.8">ID: ${u.user_id}</div>
  </div>`;
 });
 document.getElementById("list").innerHTML=html;
}

function handleSearch(){
 const v=search.value;
 addBtn.style.display=/^\d{7,11}$/.test(v)?"block":"none";
 render();
}

function switchTab(t,e){
 tab=t;
 document.querySelectorAll(".tab").forEach(x=>x.classList.remove("active"));
 e.classList.add("active");
 render();
}

function openModal(id){
 activeId=id;
 const u=users.find(x=>x.user_id===id);
 mName.innerText=u.name||"User";
 mInfo.innerHTML=`ID: ${u.user_id}<br>Pkg: ${u.package}<br>Exp: ${u.expire}`;
 pay.href=`https://ispbill.com/pay.php?c=1021&q=${u.billing_id||u.user_id}`;
 modal.style.display="flex";
}

function closeModal(){modal.style.display="none"}

async function addUser(){
 show();
 await fetch(`${API_URL}/fetch_user?id=${search.value}`);
 await load();
 search.value=""; addBtn.style.display="none";
}

async function deleteUser(){
 if(!confirm("ডিলিট করবেন?")) return;
 show();
 await fetch(`${API_URL}/delete_user?id=${activeId}`);
 await load();
 closeModal();
}

async function syncAll(){
 show();
 await fetch(API_URL+"/sync_sheet");
 await load();
}

function show(){loader.style.display="flex"}
function hide(){loader.style.display="none"}
</script>

</body>
</html>
